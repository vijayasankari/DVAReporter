// src/components/VulnerabilityList.jsx
import { useEffect } from 'react';
import axios from 'axios';

function VulnerabilityList({ vulnerabilities, setVulnerabilities, selected, setSelected }) {
  useEffect(() => {
    axios.get('http://127.0.0.1:8000/vulnerabilities')
      .then(res => setVulnerabilities(res.data))
      .catch(err => console.error('Error fetching vulnerabilities:', err));
  }, [setVulnerabilities]);

  const toggleSelect = (vuln) => {
    if (selected.find(v => v.id === vuln.id)) {
      setSelected(selected.filter(v => v.id !== vuln.id));
    } else {
      setSelected([...selected, vuln]);
    }
  };

  return (
    <div className="flex gap-4">
      <div className="w-1/2 border p-4 rounded shadow">
        <h2 className="text-xl font-bold mb-2">All Vulnerabilities</h2>
        <ul className="space-y-1">
          {vulnerabilities.map(v => (
            <li key={v.id} className="flex justify-between items-center border p-2 rounded hover:bg-gray-50">
              <span>{v.title}</span>
              <button className="text-sm bg-blue-100 px-2 py-1 rounded" onClick={() => toggleSelect(v)}>
                {selected.find(sel => sel.id === v.id) ? 'Remove' : 'Add'}
              </button>
            </li>
          ))}
        </ul>
      </div>

      <div className="w-1/2 border p-4 rounded shadow">
        <h2 className="text-xl font-bold mb-2">Selected Vulnerabilities</h2>
        <ul className="space-y-1">
          {selected.map(v => (
            <li key={v.id} className="border p-2 rounded">
              {v.title} â€” <span className="font-semibold">{v.severity}</span>
            </li>
          ))}
        </ul>
      </div>
    </div>
  );
}

export default VulnerabilityList;
